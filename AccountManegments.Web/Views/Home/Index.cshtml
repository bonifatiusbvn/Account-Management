@using AccountManegments.Web.Models;
@inject IHttpContextAccessor Accessor;
@inject UserSession _userSession
@{
    ViewData["Title"] = "Home";
    Layout = "~/Views/Shared/Main_Layout.cshtml";
}



<!--start breadcrumb-->
@* <div class="page-breadcrumb d-none d-sm-flex align-items-center mb-3">
    <div class="breadcrumb-title pe-3">Dashboard</div>
    <div class="ps-3">

    </div>

</div> *@
<div class="row">
    <div class="col-12 col-lg-4 col-xl-4 d-flex">
        <div class="card radius-10 w-100">
            <form id="frmdrpdashbord">
                @if (_userSession.UserRole == 3)
                {
                    <select class="form-control form-control-lg" id="drpSiteName" onchange="fn_ChangeSite()">
                        <option value="null" selected>All Site</option>
                    </select>
                }
                else
                {
                    <select class="form-control form-control-lg" id="drpSiteName" onchange="fn_ChangeSite()" disabled>
                        <option value="@UserSession.SiteId" selected disabled>@UserSession.SiteName</option>
                    </select>
                }
            </form>
        </div>

    </div>

    <div class="col-12 col-lg-4 col-xl-4 d-flex">
        <div class="card radius-10 w-100">
            <form id="cmplistdashbord">

                <select class="form-control form-control-lg" id="CompanyNameList">
                    @if (_userSession.UserRole != 3)
                    {
                        <option selected disabled value="">Select Company</option>
                    }
                </select>
            </form>
        </div>
    </div>
</div>

<!--end breadcrumb-->

<div class="row">
    <div class="col-12 col-lg-8 col-xl-8 d-flex">
        <div class="card radius-10 w-100">
            <div class="card-header">
                <h5>Purchase Requests</h5>

            </div>
            <div class="card-body">
                <div class="table-responsive mt-3" style="max-height:350px;">
                    <table class="table align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Item</th>
                                <th>Unit</th>
                                <th>Qty</th>
                                <th>Site</th>
                                <th>Status</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="tbPndingApproval">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12 col-lg-4 col-xl-4 d-flex">
        <div class="card radius-10 overflow-hidden w-100">
            <div class="card-header">
                <h5>Supplier Pending</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive mt-3" style="max-height:350px;">
                    <table class="table align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Company</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>D. M. Infra</td>
                                <td class="alert-danger">

                                    <i class="lni lni-rupee"></i>
                                    2500000.00
                                </td>

                            </tr>
                            <tr>
                                <td>D. M. Infra</td>
                                <td class="alert-danger">

                                    <i class="lni lni-rupee"></i>
                                    2500000.00
                                </td>

                            </tr>
                            <tr>
                                <td>D. M. Infra</td>
                                <td class="alert-danger">

                                    <i class="lni lni-rupee"></i>
                                    2500000.00
                                </td>

                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
@section Scripts {
    <script type="text/javascript">
        var role = "@_userSession.UserRole";
        $(function () {
            fn_fillsiteDropDown('#drpSiteName')
            $('#drpSiteName').val("@UserSession.SiteId")
            fn_ChangeSite();
            GetCompanyList();
        });


        function fn_fillsiteDropDown(drpid) {

            $.ajax({
                url: '/SiteMaster/GetSiteNameList',
                success: function (result) {
                    $.each(result, function (i, data) {

                        $(drpid).append('<option value=' + data.siteId + '>' + data.siteName + '</Option>')

                    });

                }
            });
        }

        function fn_ChangeSite() {

            var selectedSiteId = $('#drpSiteName').val();
            var SiteName = $('#drpSiteName').text()
            var searchText = "";
            var searchBy = "";

            $.ajax({
                url: '/Home/PurchaseRequestList',
                type: 'GET',
                data: {
                    searchText: searchText,
                    searchBy: searchBy,
                    SiteId: selectedSiteId,

                },
                success: function (result) {

                    $("#tbPndingApproval").html(result);
                    $('#drplaySiteName').val($('#drpSiteName option:selected').text());
                },
                error: function (xhr, status, error) {
                    // Handle error if needed
                }
            });
        }


        function GetCompanyList() {

            $('#CompanyNameList').empty();
            $.ajax({
                url: '/Company/GetCompanyNameList',
                success: function (result) {
                    if (result.length > 0) {
                        $.each(result, function (i, data) {
                            $('#CompanyNameList').append('<Option value=' + data.companyId + '>' + data.companyName + '</Option>')
                        });
                    }
                },
                error: function (xhr, status, error) {

                }
            });
        }
    </script>
}
